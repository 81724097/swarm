<!doctype html>
<html ng-app="app" ng-controller="MainController" ng-click="docClick()">
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
  <style>
    body {
      background: black;
      color: lightgreen;
    }
  </style>
</head>
<body>
  <div ng-cloak ng-if="progress()">
    <h1><a href="..">RELEASE COMPLETED</a></h1>
    <audio controls loop>
      <source src="https://s3.amazonaws.com/swarmsim-dev/zadupd02.ogg" type="audio/ogg">
    </audio>
  </div>
  <div ng-cloak ng-if="!progress()">
    <p>No release currently in progress. Checking back in 60s.</p>
  </div>
  <div ng-if="!progress">Loading...</div>
</body>
<script>
angular.module('app', []).controller('MainController', function($scope, $location, $timeout) {
  $scope.progress = function() {
    return !!$location.search().progress;
  }
  $scope.docClick = function() {
    if ($scope.progress()) {
      document.location = '..';
    }
  }

  if ($scope.progress()) {
    if (!!$location.search().quiet) {
      document.location = '..';
    }
    else {
      $timeout(function(){$('audio')[0].play();}, 0);
    }
  }
  $timeout(function(){document.location.reload();}, 60 * 1000);
});
</script>
</html>
